% !Mode:: "TeX:UTF-8"
\chapter{绪论}

%我是康乔～～～～～～～～欢迎使用北京航空航天大学毕业设计论文毕业设计论文\LaTeX{}模板，
%本模板由北航开源俱乐部(BHOSC)维护，根据北京航空航天大学教务处的
%本科生毕业设计论文要求和研究生毕业设计论文要求来编写的。
%
%目前本模板支持本科、(学术/专业)硕士和博士研究生毕业设计论文要求规范。
%
%本模板在编写过程中尽可能满足学校要求，但是由于原始规范主要针对Word。
%和\LaTeX{}之间不可避免的差异加之编写者的水平限制，本模板很难做到完全一致。
%我们十分欢迎北航的\LaTeX{}爱好者/专家参与到本模板的完善工作中，
%希望本模板能够对各位同学的论文撰写工作提供便利，
%感谢您对我们工作的信任以及任何可能的反馈和贡献。
%如果您对开发和完善本模板\,BUAAthesis.cls\,有兴趣，
%或者有任何想法和建议，请与我们联系！
%
%{\heiti 注意：}本模板在尽可能满足学校要求的同时，在细节处理上，
%倾向于遵从\LaTeX{}排版规范，避免使用奇怪的宏包和编写者认为不规范的设置。
%所以难免和学校提供的基于Word的样张存在细微差异，请谨慎使用！

\section{课题背景与意义}

二进制代码插入是通过对二进制可执行文件进行修改，
从而获取对程序执行流的操纵的技术。
%%
二进制代码插入技术是编写病毒，调试和破解闭源系统及软件，
入侵检测和预防的基础技术之一\upcite{cerburus}。
%%
利用二进制代码插入技术编写的Unix平台上的病毒已经不是新鲜事，
早在1998年，\cite{silvio}就给出了一个原始的Unix病毒的原型。

由Wind River公司开发的vxWorks操作系统是
国内外最广泛使用的具有极高实时性和可靠性的嵌入式操作系统之一。
很多嵌入式设备都使用它，例如打印机。
%%
文件格式上，vxWorks系统使用了与UNIX系统相同的ELF
（Executable and Linkable file，可链接执行文件）格式，
这一方面为UNIX平台的病毒在vxWorks上的移植和蔓延提供了方便，
另一方面，我们也可以使用类似UNIX上的二进制代码技术
对其进行二进制层面的破解、调试和攻击。
%%
最近，一项针对惠普打印机的攻击实验\upcite{printme}已经证实，
当有可利用的漏洞用于获取嵌入式设备固件并修改之的时候，
二进制代码技术将大有用武之地。


鉴于此，
本课题在整理和分析已有的UNIX下ELF文件插入技术的基础上，
寻找合适的技术并设计方案，
实现对于vxWorks操作系统映像文件的二进制插入操作。
目的是在不影响系统正常运行的前提下，
系统启动完成后，获取控制权，
让系统自动执行我们事先植入的代码。

\section{国内外研究现状}

\subsection{ELF文件代码插入技术}

二进制代码插入技术最早用于制作病毒，Silvio Cesare在\cite{silvio}
首次提出在UNIX中通过静态修改ELF可执行文件来注入代码。
一旦一个携带病毒代码的传播程序被目标机器执行，
将会把病毒代码注入到本地的另一个可执行文件中。
注入代码的同时，修改ELF的文件头的程序入口点，
指向被插入的病毒代码。
一旦这个被感染的文件被执行，它将进行一些恶意操作，
并自动感染其他目录的ELF文件，从而引起病毒传播。
%%
在这一原始的病毒模型提出之后，又有人做了改进。
例如\cite{simple}继承了\cite{silvio}的代码插入的技术方法，
但在病毒的传播和感染机制上做了改进。
%%
又如\cite{prototype}改进了病毒在获取自身代码的办法，
不再从磁盘文件中获取，而是从内存中取得。


随着更多的程序开始使用动态链接机制，人们开始从动态链接的原理和数据结构中
寻找突破口。
利用动态链接机制最大的好处是，
不一定非要在程序的开始处执行被插入的代码，
而是可以劫持任何一个特定的函数。
\cite{sharelib}较早提出了一种在插入的代码中
修改plt（Procedure Linkage Table,过程链接表）
的机制，一旦成功，
程序每次调用某个动态库函数（例如printf），
在进入函数体之前，会先执行一段事先插入的代码。
%%
然而这种方法未免有些“为了插入而插入”，
硬编码的成分过多导致这种方法难以移植到其他平台。
之后，\cite{modern}进行了大幅改进，
不需要在程序执行之前修改磁盘的文件，
即程序已经开始运行，通过修改内存也能实现劫持。

在ELF插入代码无论是否利用动态链接机制，
最终都可以归结为绕过链接的一种文件合并。
无论插入代码的技术多么先进和隐蔽，
能否在被插入代码体中完成一定任务，
而不是打印一行“hello world!”就归还控制权，
特别是在插入代码量有一定限制的情况下。
%%
然而我们的插入工具始终不能像编译器和链接器那样，
在ELF的相应数据结构中植入对动态库函数的引用，
因此插入的代码往往只能使用系统调用。
针对这一问题，\cite{subversive}提出了在插入代码中，
利用显式运行时链接机制，显式地要求动态链接为我们打开所需要的共享库。
从而帮助我们完成任务。
这也说明，动态链接机制不但帮助程序节省了空间，
也让在夹缝中生存的病毒有了更多可利用的资源。


最终，为了整合这些功能，同时把ELF文件修改操作接口化，
一个专门针对ELF文件修改的工具ELFsh\upcite{elfsh}被开发了出来。
后续的一些工作如\cite{cerberus}开始充分利用它的强大功能。
本课题的研究不但使用了它的接口，
也借鉴了其源代码中包含的一些技术。


\subsection{嵌入式系统中的二进制插入技术}

逆向工程师一个乐此不疲的目标就是破解各种嵌入式设备固件，
例如XBOX游戏机\upcite{xbox}，Apple公司的产品\upcite{apple}，
甚至对硬盘也不放过\upcite{disk}。


在ELF代码插入技术逐渐被完善甚至工具化的同时，
所有使用了ELF文件格式的平台都应当保持警惕。
vxWorks在工业和国防等领域有着广泛的应用\upcite{vxworks1}，
一个典型的例子是\cite{printme}，在利用惠普打印机固件
更新漏洞的基础上，通过网络对打印机的vxWorks的固件进行了修改。
当打印机再次工作时，攻击者们就可以通过网络得到打印机的所有工作信息，
比如打印文档的内容。
当然，与插入和修改系统镜像的技术相比，找到能利用的漏洞
同样重要，甚至是先决条件，因为毕竟不是每个人都能直接读写设备固件。
%%
但我们在此更关注注入技术：即攻击者如何修改了vxWorks镜像，
让打印机能够为它工作，并且不出现异常。
一旦这项技术在特定场景下被实例化，
在物理隔离被破坏的基础上，哪怕是一瞬间，
也可能意味着你所有的嵌入式设备将会成为你的间谍。

\section{课题研究目标与内容}

为了能够考察在vxWorks中实现代码插入的可行性，
并选择适当的方案，
%%%%%
本文首先整理各种出现过的典型的ELF代码插入技术
分析其特征、应用原理、适用范围和限制，
从而选择适合向vxWorks进行插入的方法。
%%%
这一部分工作同时也为ELF乃至
其他文件格式的二进制修改技术的研究提供了一定的基础。


在选定插入方案的基础上，
分别尝试？？？？？方法，对vxWorks系统镜像进行修改，
从而截获usrAppInit()函数
（vxWorks启动完成后，首先会调用该函数）
或者其他特定的函数。
%%%%%%%%%%%
一旦系统开始运行，每次调用被截获的函数，
我们的插入的代码都会获得控制权。
插入代码执行完毕之后，会把控制权重新交给被截获的函数，
而不影响该函数乃至系统的正常运行。
为了证明确实截获成功，
插入代码需要进行一些简单的操作，例如向屏幕输出一行字符串

\section{论文组织结构}

论文第二章首先列出了各种典型的ELF文件代码插入技术，
并给出了一些简单的示例。
通过分析它们的技术原理，
确定可能的适用范围，
并指出他们各自存在的缺陷。
同时考虑vxWorks的具体情况，
选择合适的技术方案。

第三章利用XXX技术对XXXX

第四章利用xxx技术对xxxxx

第五章简单评估所有成功的方案，
对比其代价和效果

最后给出结论和可能的改进措施。

%%%\section{相关信息}
%%%
%%%\subsection{模板维护及联系方式}
%%%\begin{tabular}{ll}
%%%    \multicolumn{2}{l}{北航开源俱乐部 BeiHang OpenSource Club (BHOSC)} \\
%%%    GoogleGroup & \url{https://groups.google.com/d/forum/BHOSC/} \\
%%%    Github      & \url{https://github.com/BHOSC/} \\
%%%    IRC         & \#beihang-osc @ FreeNode
%%%\end{tabular}
%%%
%%%\subsection{代码托管及相关页面}
%%%\begin{itemize}
%%%    \item 毕业设计论文模板代码
%%%    \item[] \url{https://github.com/BHOSC/BUAAthesis/}
%%%    % TODO(huxuan): Others pages related to BUAAthesis
%%%    % \item 软件学院本科毕设答辩演示模板
%%%    % \item[] \url{https://github.com/huxuan/latex\_buaasoft\_bachelor\_slide}
%%%    % \item 研究生毕设综述报告和开题报告模板
%%%    % \item[] \url{https://github.com/JosephPeng/ZongshuKaiti\}
%%%\end{itemize}
%%%
%%%\subsection{贡献者}
%%%\begin{tabularx}{\textwidth}{@{\hspace{2em}}ll}
%%%    \href{https://github.com/JosephPeng/}{Joseph \footnote{目前的维护者}} &
%%%    \href{mailto:mrpeng000@gmail.com}{mrpeng000@gmail.com} \\
%%%    \href{http://huxuan.org/}{huxuan \textsuperscript{1}} &
%%%    \href{mailto:i@huxuan.org}{i@huxuan.org} \\
%%%\end{tabularx}
%%%
%%%\subsection{项目协议}
%%%本项目主要遵从以下两套协议
%%%\begin{itemize}
%%%    \item \href{http://www.gnu.org/licenses/gpl.txt}
%%%        {GNU General Public License (GPLv3)}
%%%    \item \href{http://www.latex-project.org/lppl.txt}
%%%        {\LaTeX{} Project Public License (LPPL)}
%%%\end{itemize}
%%%使用前请认真阅读相关协议，详情请见项目代码根目录下的 LICENSE 文件
%%%
%%%\section{免责声明}
%%%本模板为编写者依据北京航空航天大学研究生院及教务处出台的
%%%《北京航空航天大学研究生撰写学位论文规定（2009年7月修订）》和
%%%《本科生毕业设计（论文）撰写规范及要求》编写而成，
%%%旨在方便北京航空航天大学毕业生撰写学位论文使用。
%%%
%%%如前所述，本模板为北航开源俱乐部\LaTeX{}爱好者依据学校的要求规范编写，
%%%研究生院及教务处只提供毕业论文的写作规范，目前并未提供官方\LaTeX{}模板，
%%%也未授权第三方模板为官方模板，故此模板仅为论文规范的参考实现，
%%%不保证格式能完全满足审查老师要求。任何由于使用本模板而引起的论文格式等问题，
%%%以及造成的可能后果，均与本模板编写者无关。
%%%
%%%任何组织或个人以本模板为基础进行修改、扩展而生成新模板，请严格遵守相关协议。
%%%由于违反协议而引起的任何纠纷争端均与本模板编写者无关。
%%%
%%%\section{版本历史}
%%%\begin{itemize}
%%%    \item[1.0] 2012/07/24 已完成大体功能，说明文档和细节方面还有待完善。
%%%    % “a.b”为版本号，b为奇数时为内测版本，为偶数时为发行版。
%%%\end{itemize}
